####################################################

This code is based on a preliminary version of the BSM3G code initiated by:
Andres Florez (Los Andes), Alfredo Gurrola (Vanderbilt) and Amandeep Kalsi (Panjab) 
(See https://github.com/florez/NtupleMaker_740)

It has been extended and further developed by Francesco Romeo (IHEP) and Aniello Spiezia (IHEP).

This version of code is used for 2016 miniAOD v3 && 2017 miniAOD v2 and v1  Ntuple production:
####################################################


cmsrel CMSSW_9_4_10
cd CMSSW_9_4_10/src
cmsenv

git cms-init

## set up bTagDeepFlavour
## https://twiki.cern.ch/twiki/bin/view/CMS/DeepJet
git cms-addpkg RecoBTag/TensorFlow
git cherry-pick 94ceae257f846998c357fcad408986cc8a039152
scram b -j 8

## set up Egamma Tools 
## https://twiki.cern.ch/twiki/bin/view/CMS/EgammaMiniAODV2
git cms-merge-topic cms-egamma:EgammaID_949 #if you want the FallV2 IDs, otherwise skip
git cms-merge-topic cms-egamma:EgammaPostRecoTools_940 #just adds in an extra file to have a setup function to make things easier
scram b -j 8  # for unknown reason, it may incur errors, in such case, 'scram b clean' and recompile it; please let me know if you understand the reason of errors.
         

## set up MET corrections with EE nosie fix
# https://twiki.cern.ch/twiki/bin/view/CMS/MissingETUncertaintyPrescription#Instructions_for_9_4_X_X_9_for_2
git cms-merge-topic cms-met:METFixEE2017_949_v2
scram b -j 8

## set up L1 prefire corrections
# https://twiki.cern.ch/twiki/bin/viewauth/CMS/L1ECALPrefiringWeightRecipe
git cms-merge-topic lathomas:L1Prefiring_9_4_9
scram b

## set BSM Framework
git clone https://github.com/BinghuanLi/BSMFramework.git
cd BSMFramework/
git checkout CMSSW_9_4_10
cd ..
scram b -j 8

## To Run ##
cd BSMFramework/BSM3G_TNT_Maker/python/
cmsRun miniAOD_MC2017.py # please provide the location of L1 prefire file to the producer.
#data: cmsRun miniAOD_RD2017.py(not updated yet)  FIXME

